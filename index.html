<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Platformer Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #87CEEB;
        }
        canvas {
            display: block;
            background-color: #fff;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas dimensions
        canvas.width = 800;
        canvas.height = 600;

        // Player settings
        const playerWidth = 50;
        const playerHeight = 50;
        let playerX = canvas.width / 2 - playerWidth / 2;
        let playerY = canvas.height - playerHeight - 10;
        const playerSpeed = 5;

        // Load the player image from the provided Pixabay URL
        const playerImage = new Image();
        playerImage.src = 'https://cdn.pixabay.com/photo/2023/01/04/14/24/image-7775824_960_720.png'; // Image URL from Pixabay

        // Game variables
        let isGameOver = false;
        let score = 0;

        // Coin settings
        const coinWidth = 30;
        const coinHeight = 30;
        let coinX = Math.random() * (canvas.width - coinWidth);
        let coinY = -coinHeight;
        const baseCoinSpeed = 3;
        let coinSpeed = baseCoinSpeed;

        // Obstacle settings
        const obstacleWidth = 50;
        const obstacleHeight = 50;
        let obstacleX = Math.random() * (canvas.width - obstacleWidth);
        let obstacleY = -obstacleHeight;
        const baseObstacleSpeed = 4;
        let obstacleSpeed = baseObstacleSpeed;

        // Event listeners for player controls
        let touchStartX = 0;
        let touchEndX = 0;

        canvas.addEventListener('touchstart', touchStartHandler, false);
        canvas.addEventListener('touchmove', touchMoveHandler, false);
        canvas.addEventListener('touchend', touchEndHandler, false);

        function touchStartHandler(e) {
            touchStartX = e.changedTouches[0].pageX; // Store the starting touch position
        }

        function touchMoveHandler(e) {
            e.preventDefault(); // Prevent default action to avoid scroll
            touchEndX = e.changedTouches[0].pageX; // Get the current touch position

            // Determine the direction of movement based on touch position
            if (touchEndX > touchStartX && playerX < canvas.width - playerWidth) {
                // Move right
                playerX += playerSpeed;
            } else if (touchEndX < touchStartX && playerX > 0) {
                // Move left
                playerX -= playerSpeed;
            }

            touchStartX = touchEndX; // Update the starting position for the next move
        }

        function touchEndHandler(e) {
            // Reset the touch position when touch ends
            touchStartX = 0;
            touchEndX = 0;
        }

        function drawPlayer() {
            // Draw the player image instead of the rectangle
            ctx.drawImage(playerImage, playerX, playerY, playerWidth, playerHeight);
        }

        function drawCoin() {
            ctx.beginPath();
            ctx.rect(coinX, coinY, coinWidth, coinHeight);
            ctx.fillStyle = "#FFD700";
            ctx.fill();
            ctx.closePath();
        }

        function drawObstacle() {
            ctx.beginPath();
            ctx.rect(obstacleX, obstacleY, obstacleWidth, obstacleHeight);
            ctx.fillStyle = "#FF0000";
            ctx.fill();
            ctx.closePath();
        }

        function detectCollisions() {
            // Check collision with coin
            if (playerX < coinX + coinWidth &&
                playerX + playerWidth > coinX &&
                playerY < coinY + coinHeight &&
                playerY + playerHeight > coinY) {
                score++;
                coinY = -coinHeight; // Reset coin
                coinX = Math.random() * (canvas.width - coinWidth); // New random position
            }

            // Check collision with obstacle
            if (playerX < obstacleX + obstacleWidth &&
                playerX + playerWidth > obstacleX &&
                playerY < obstacleY + obstacleHeight &&
                playerY + playerHeight > obstacleY) {
                isGameOver = true;
            }
        }

        function moveCoin() {
            coinY += coinSpeed;
            if (coinY > canvas.height) {
                coinY = -coinHeight;
                coinX = Math.random() * (canvas.width - coinWidth); // Random new position
            }
        }

        function moveObstacle() {
            obstacleY += obstacleSpeed;
            if (obstacleY > canvas.height) {
                obstacleY = -obstacleHeight;
                obstacleX = Math.random() * (canvas.width - obstacleWidth); // New random position
            }
        }

        // Increase the speed of obstacles and coins as the score increases
        function increaseDifficulty() {
            if (score % 10 === 0 && score > 0) {
                obstacleSpeed += 0.5; // Speed up obstacles every 10 points
                coinSpeed += 0.2;     // Speed up coins every 10 points
            }
        }

        let scoreMultiplier = 1;
        let multiplierDuration = 0;

        // Function to activate score multiplier
        function activateMultiplier() {
            scoreMultiplier = 2;  // Double the score for a short period
            multiplierDuration = 300; // Duration for multiplier (in frames)
        }

        // Update the score when collecting a coin
        function collectCoin() {
            score += 1 * scoreMultiplier;
            coinY = -coinHeight; // Reset coin
            coinX = Math.random() * (canvas.width - coinWidth); // New random position
            multiplierDuration--;
            if (multiplierDuration <= 0) {
                scoreMultiplier = 1;  // Reset multiplier
            }
        }

        function drawScore() {
            ctx.font = "16px Arial";
            ctx.fillStyle = "#000";
            ctx.fillText("Score: " + score, 8, 20);
            if (scoreMultiplier > 1) {
                ctx.fillText("x" + scoreMultiplier, canvas.width - 100, 20);
            }
        }

        function gameOver() {
            ctx.font = "30px Arial";
            ctx.fillStyle = "#FF0000";
            ctx.fillText("GAME OVER!", canvas.width / 2 - 100, canvas.height / 2);
        }

        function draw() {
            if (isGameOver) {
                gameOver();
                return;
            }

            increaseDifficulty(); // Increase difficulty based on score

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPlayer();
            drawCoin();
            drawObstacle();
            drawScore();
            detectCollisions();
            moveCoin();
            moveObstacle();

            requestAnimationFrame(draw);
        }

        // Wait for the image to load before starting the game
        playerImage.onload = function() {
            draw(); // Start the game loop once the image is loaded
        }
    </script>
</body>
</html>
